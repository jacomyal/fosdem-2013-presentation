/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(h,k){var e=this.length;if("function"!=typeof h)throw new TypeError;for(var i=0;i<e;i++)if(i in this&&h.call(k,this[i],i,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(h,k){var e=this.length;if("function"!=typeof h)throw new TypeError;for(var i=0;i<e;i++)i in this&&h.call(k,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(h,k){var e=this.length;if("function"!=typeof h)throw new TypeError;
for(var i=Array(e),j=0;j<e;j++)j in this&&(i[j]=h.call(k,this[j],j,this));return i});Array.prototype.filter||(Array.prototype.filter=function(h,k){var e=this.length;if("function"!=typeof h)throw new TypeError;for(var i=[],j=0;j<e;j++)if(j in this){var t=this[j];h.call(k,t,j,this)&&i.push(t)}return i});Object.keys||(Object.keys=function(){var h=Object.prototype.hasOwnProperty,k=!{toString:null}.propertyIsEnumerable("toString"),e="toString,toLocaleString,valueOf,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,constructor".split(","),
i=e.length;return function(j){if("object"!==typeof j&&"function"!==typeof j||null===j)throw new TypeError("Object.keys called on non-object");var t=[],s;for(s in j)h.call(j,s)&&t.push(s);if(k)for(s=0;s<i;s++)h.call(j,e[s])&&t.push(e[s]);return t}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(h,k){if("string"==typeof h&&void 0==k)return this.p[h];var e="object"==typeof h&&void 0==k?h:{};"string"==typeof h&&(e[h]=k);for(var i in e)void 0!=this.p[i]&&(this.p[i]=e[i]);return this}};
sigma.classes.EventDispatcher=function(){var h={},k=this;this.one=function(e,i){if(!i||!e)return k;("string"==typeof e?e.split(" "):e).forEach(function(e){h[e]||(h[e]=[]);h[e].push({h:i,one:!0})});return k};this.bind=function(e,i){if(!i||!e)return k;("string"==typeof e?e.split(" "):e).forEach(function(e){h[e]||(h[e]=[]);h[e].push({h:i,one:!1})});return k};this.unbind=function(e,i){e||(h={});var j="string"==typeof e?e.split(" "):e;i?j.forEach(function(e){h[e]&&(h[e]=h[e].filter(function(e){return e.h!=
i}));h[e]&&0==h[e].length&&delete h[e]}):j.forEach(function(e){delete h[e]});return k};this.dispatch=function(e,i){h[e]&&(h[e].forEach(function(h){h.h({type:e,content:i,target:k})}),h[e]=h[e].filter(function(e){return!e.one}));return k}};
(function(){var h;function k(b,u){function g(){var a;a="<p>GLOBAL :</p>";for(var b in c.p.globalProbes)a+="<p>"+b+" : "+c.p.globalProbes[b]()+"</p>";a+="<br><p>LOCAL :</p>";for(b in c.p.localProbes)a+="<p>"+b+" : "+c.p.localProbes[b]()+"</p>";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:u,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,
FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(g,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function e(b){function u(d){a.p.mouseEnabled&&(g(a.mouseX,a.mouseY,a.ratio*(0<(void 0!=d.wheelDelta&&d.wheelDelta||
void 0!=d.detail&&-d.detail)?a.p.zoomMultiply:1/a.p.zoomMultiply)),a.p.blockScroll&&(d.preventDefault?d.preventDefault():d.returnValue=!1))}function g(d,b,l){if(!a.isMouseDown&&(window.clearInterval(a.interpolationID),j=void 0!=l,n=a.stageX,x=d,A=a.stageY,p=b,f=l||a.ratio,f=Math.min(Math.max(f,a.p.minRatio),a.p.maxRatio),i=a.p.directZooming?1-(j?a.p.zoomDelta:a.p.dragDelta):0,a.ratio!=f||a.stageX!=x||a.stageY!=p))c(),a.interpolationID=window.setInterval(c,50),a.dispatch("startinterpolate")}function c(){i+=
j?a.p.zoomDelta:a.p.dragDelta;i=Math.min(i,1);var d=sigma.easing.quadratic.easeout(i),c=a.ratio;a.ratio=c*(1-d)+f*d;j?(a.stageX=x+(a.stageX-x)*a.ratio/c,a.stageY=p+(a.stageY-p)*a.ratio/c):(a.stageX=n*(1-d)+x*d,a.stageY=A*(1-d)+p*d);a.dispatch("interpolate");1<=i&&(window.clearInterval(a.interpolationID),d=a.ratio,j?(a.ratio=f,a.stageX=x+(a.stageX-x)*a.ratio/d,a.stageY=p+(a.stageY-p)*a.ratio/d):(a.stageX=x,a.stageY=p),a.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);
var a=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var m=0,d=0,n=0,A=0,f=1,x=0,p=0,l=0,q=0,e=0,h=0,i=0,j=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",u,!0);b.addEventListener("mousewheel",u,!0);b.addEventListener("mousemove",function(c){a.mouseX=void 0!=c.offsetX&&c.offsetX||void 0!=c.layerX&&c.layerX||void 0!=c.clientX&&
c.clientX;a.mouseY=void 0!=c.offsetY&&c.offsetY||void 0!=c.layerY&&c.layerY||void 0!=c.clientY&&c.clientY;if(a.isMouseDown){var b=a.mouseX-m+n,f=a.mouseY-d+A;if(b!=a.stageX||f!=a.stageY)q=l,h=e,l=b,e=f,a.stageX=b,a.stageY=f,a.dispatch("drag")}a.dispatch("move");c.preventDefault?c.preventDefault():c.returnValue=!1},!0);b.addEventListener("mousedown",function(c){a.p.mouseEnabled&&(a.isMouseDown=!0,a.dispatch("mousedown"),n=a.stageX,A=a.stageY,m=a.mouseX,d=a.mouseY,q=l=a.stageX,h=e=a.stageY,a.dispatch("startdrag"),
c.preventDefault?c.preventDefault():c.returnValue=!1)},!0);document.addEventListener("mouseup",function(d){a.p.mouseEnabled&&a.isMouseDown&&(a.isMouseDown=!1,a.dispatch("mouseup"),(n!=a.stageX||A!=a.stageY)&&g(a.stageX+a.p.inertia*(a.stageX-q),a.stageY+a.p.inertia*(a.stageY-h)),d.preventDefault?d.preventDefault():d.returnValue=!1)},!0);this.checkBorders=function(){return a};this.interpolate=g}function i(b,u){function g(){sigma.chronos.removeTask("node_"+d.id,2).removeTask("edge_"+d.id,2).removeTask("label_"+
d.id,2).stopTasks();return d}function c(a,c){d.domElements[a]=document.createElement(c);d.domElements[a].style.position="absolute";d.domElements[a].setAttribute("id","sigma_"+a+"_"+d.id);d.domElements[a].setAttribute("class","sigma_"+a+"_"+c);d.domElements[a].setAttribute("width",d.width+"px");d.domElements[a].setAttribute("height",d.height+"px");d.domRoot.appendChild(d.domElements[a]);return d}function a(){d.p.drawHoverNodes&&(d.graph.checkHover(d.mousecaptor.mouseX,d.mousecaptor.mouseY),d.graph.nodes.forEach(function(a){a.hover&&
!a.active&&d.plotter.drawHoverNode(a)}));return d}function m(){d.p.drawActiveNodes&&d.graph.nodes.forEach(function(a){a.active&&d.plotter.drawActiveNode(a)});return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.id=u.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=b;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=
new t;this.domElements={};c("edges","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new s(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new k(this,this.domElements.monitor);this.mousecaptor=new e(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",
function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?1:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var c=d.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});d.dispatch("mousedown"==a.type?"downgraph":"upgraph");c.length&&d.dispatch("mousedown"==a.type?"downnodes":"upnodes",c)}).bind("move",function(){d.domElements.hover.getContext("2d").clearRect(0,
0,d.domElements.hover.width,d.domElements.hover.height);a();m()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))})&&d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels)}).bind("stopgenerators",function(){d.draw()});for(var n=0;n<h.length;n++)h[n](this);this.draw=function(a,c,b,m){if(m&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",
""))}))return d;a=void 0==a?d.p.drawNodes:a;c=void 0==c?d.p.drawEdges:c;b=void 0==b?d.p.drawLabels:b;m={nodes:a,edges:c,labels:b};d.p.lastNodes=a;d.p.lastEdges=c;d.p.lastLabels=b;g();d.graph.rescale(d.width,d.height,0<a,0<c).setBorders();d.mousecaptor.checkBorders(d.graph.borders,d.width,d.height);d.graph.translate(d.mousecaptor.stageX,d.mousecaptor.stageY,d.mousecaptor.ratio,0<a,0<c);d.dispatch("graphscaled");for(var l in d.domElements)"canvas"==d.domElements[l].nodeName.toLowerCase()&&(void 0==
m[l]||0<=m[l])&&d.domElements[l].getContext("2d").clearRect(0,0,d.domElements[l].width,d.domElements[l].height);d.plotter.currentEdgeIndex=0;d.plotter.currentNodeIndex=0;d.plotter.currentLabelIndex=0;l=null;m=!1;if(a)if(1<a)for(;d.plotter.task_drawNode(););else sigma.chronos.addTask(d.plotter.task_drawNode,"node_"+d.id,!1),m=!0,l="node_"+d.id;if(b)if(1<b)for(;d.plotter.task_drawLabel(););else l?sigma.chronos.queueTask(d.plotter.task_drawLabel,"label_"+d.id,l):sigma.chronos.addTask(d.plotter.task_drawLabel,
"label_"+d.id,!1),m=!0,l="label_"+d.id;if(c)if(1<c)for(;d.plotter.task_drawEdge(););else l?sigma.chronos.queueTask(d.plotter.task_drawEdge,"edge_"+d.id,l):sigma.chronos.addTask(d.plotter.task_drawEdge,"edge_"+d.id,!1),m=!0,l="edge_"+d.id;d.dispatch("draw");d.refresh();m&&sigma.chronos.runTasks();return d};this.resize=function(a,c){var b=d.width,m=d.height;void 0!=a&&void 0!=c?(d.width=a,d.height=c):(d.width=d.domRoot.offsetWidth,d.height=d.domRoot.offsetHeight);if(b!=d.width||m!=d.height){for(var l in d.domElements)d.domElements[l].setAttribute("width",
d.width+"px"),d.domElements[l].setAttribute("height",d.height+"px");d.plotter.resize(d.width,d.height);d.draw(d.p.lastNodes,d.p.lastEdges,d.p.lastLabels,!0)}return d};this.refresh=function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);a();m();return d};this.drawHover=a;this.drawActive=m;this.clearSchedule=g;window.addEventListener("resize",function(){d.resize()})}function j(b){var e=this;sigma.classes.EventDispatcher.call(this);this._core=
b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(g,c){var a=b.config(g,c);return a==b?e:a};this.drawingProperties=function(g,c){var a=b.plotter.config(g,c);return a==b.plotter?e:a};this.mouseProperties=function(g,c){var a=b.mousecaptor.config(g,c);return a==b.mousecaptor?e:a};this.graphProperties=function(g,c){var a=b.graph.config(g,c);return a==b.graph?e:a};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,down:b.mousecaptor.isMouseDown}};
this.position=function(g,c,a){if(0==arguments.length)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};b.mousecaptor.stageX=void 0!=g?g:b.mousecaptor.stageX;b.mousecaptor.stageY=void 0!=c?c:b.mousecaptor.stageY;b.mousecaptor.ratio=void 0!=a?a:b.mousecaptor.ratio;return e};this.goTo=function(g,c,a){b.mousecaptor.interpolate(g,c,a);return e};this.zoomTo=function(g,c,a){a=Math.min(Math.max(b.mousecaptor.config("minRatio"),a),b.mousecaptor.config("maxRatio"));a==
b.mousecaptor.ratio?b.mousecaptor.interpolate(g-b.width/2+b.mousecaptor.stageX,c-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((a*g-b.mousecaptor.ratio*b.width/2)/(a-b.mousecaptor.ratio),(a*c-b.mousecaptor.ratio*b.height/2)/(a-b.mousecaptor.ratio),a);return e};this.resize=function(g,c){b.resize(g,c);return e};this.draw=function(g,c,a,m){b.draw(g,c,a,m);return e};this.refresh=function(){b.refresh();return e};this.addGenerator=function(g,c,a){sigma.chronos.addGenerator(g+"_ext_"+b.id,c,
a);return e};this.removeGenerator=function(g){sigma.chronos.removeGenerator(g+"_ext_"+b.id);return e};this.addNode=function(g,c){b.graph.addNode(g,c);return e};this.addEdge=function(g,c,a,m){b.graph.addEdge(g,c,a,m);return e};this.dropNode=function(g){b.graph.dropNode(g);return e};this.dropEdge=function(g){b.graph.dropEdge(g);return e};this.pushGraph=function(g,c){g.nodes&&g.nodes.forEach(function(a){a.id&&(!c||!b.graph.nodesIndex[a.id])&&e.addNode(a.id,a)});g.edges&&g.edges.forEach(function(a){(validID=
a.source&&a.target&&a.id)&&(!c||!b.graph.edgesIndex[a.id])&&e.addNode(a.id,a.source,a.target,a)});return e};this.emptyGraph=function(){b.graph.empty();return e};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(g,c){b.graph.iterNodes(g,c);return e};this.iterEdges=function(g,c){b.graph.iterEdges(g,c);return e};this.getNodes=function(g){return b.graph.getNodes(g)};this.getEdges=function(g){return b.graph.getEdges(g)};
this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downgraph upgraph",function(b){e.dispatch(b.type,b.content)});b.graph.bind("overnodes outnodes",function(b){e.dispatch(b.type,b.content)})}function t(){function b(a){return{x:a.x,y:a.y,size:a.size,degree:a.degree,inDegree:a.inDegree,outDegree:a.outDegree,displayX:a.displayX,displayY:a.displayY,displaySize:a.displaySize,label:a.label,id:a.id,
color:a.color,fixed:a.fixed,active:a.active,hidden:a.hidden,attr:a.attr}}function e(a){return{source:a.source.id,target:a.target.id,size:a.size,type:a.type,weight:a.weight,displaySize:a.displaySize,label:a.label,id:a.id,attr:a.attr,color:a.color}}function g(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,
edgesPowRatio:0};this.borders={};g();this.addNode=function(a,b){if(c.nodesIndex[a])throw Error('Node "'+a+'" already exists.');var b=b||{},d={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,label:a.toString(),id:a.toString(),attr:{}},e;for(e in b)switch(e){case "id":break;case "x":case "y":case "size":d[e]=+b[e];break;case "fixed":case "active":case "hidden":d[e]=!!b[e];break;case "color":case "label":d[e]=b[e];break;default:d.attr[e]=b[e]}c.nodes.push(d);c.nodesIndex[a.toString()]=
d;return c};this.addEdge=function(a,b,d,e){if(c.edgesIndex[a])throw Error('Edge "'+a+'" already exists.');if(!c.nodesIndex[b])throw Error("Edge's source \""+b+'" does not exist yet.');if(!c.nodesIndex[d])throw Error("Edge's target \""+d+'" does not exist yet.');e=e||{};b={source:c.nodesIndex[b],target:c.nodesIndex[d],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),attr:{}};b.source.degree++;b.source.outDegree++;b.target.degree++;b.target.inDegree++;for(var g in e)switch(g){case "id":case "source":case "target":break;
case "size":b[g]=+e[g];break;case "color":b[g]=e[g].toString();break;case "type":b[g]=e[g].toString();break;case "label":b[g]=e[g];break;default:b.attr[g]=e[g]}c.edges.push(b);c.edgesIndex[a.toString()]=b;return c};this.dropNode=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.nodesIndex[a]){var d=null;c.nodes.some(function(c,b){return c.id==a?(d=b,!0):!1});null!=d&&c.nodes.splice(d,1);delete c.nodesIndex[a];c.edges=c.edges.filter(function(d){if(d.source.id==a)return delete c.edgesIndex[d.id],
d.target.degree--,d.target.inDegree--,!1;return d.target.id==a?(delete c.edgesIndex[d.id],d.source.degree--,d.source.outDegree--,!1):!0})}else sigma.log('Node "'+a+'" does not exist.')});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.edgesIndex[a]){c.edgesIndex[a].source.degree--;c.edgesIndex[a].source.outDegree--;c.edgesIndex[a].target.degree--;c.edgesIndex[a].target.inDegree--;var d=null;c.edges.some(function(c,b){return c.id==a?(d=b,!0):!1});null!=
d&&c.edges.splice(d,1);delete c.edgesIndex[a]}else sigma.log('Edge "'+a+'" does not exist.')});return c};this.iterEdges=function(a,b){var d=b?b.map(function(a){return c.edgesIndex[a]}):c.edges,g=d.map(e);g.forEach(a);d.forEach(function(a,d){var b=g[d],e;for(e in b)switch(e){case "id":case "weight":case "displaySize":break;case "size":a[e]=+b[e];break;case "source":case "target":a[e]=c.nodesIndex[e]||a[e];break;case "color":case "label":case "type":a[e]=(b[e]||"").toString();break;default:a.attr[e]=
b[e]}});return c};this.iterNodes=function(a,e){var d=e?e.map(function(a){return c.nodesIndex[a]}):c.nodes,g=d.map(b);g.forEach(a);d.forEach(function(a,d){var c=g[d],b;for(b in c)switch(b){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[b]=+c[b];break;case "fixed":case "active":case "hidden":a[b]=!!c[b];break;case "color":case "label":a[b]=c[b].toString();break;default:a.attr[b]=c[b]}});return c};
this.getEdges=function(a){var b=((a instanceof Array?a:[a])||[]).map(function(a){return e(c.edgesIndex[a])});return a instanceof Array?b:b[0]};this.getNodes=function(a){var e=((a instanceof Array?a:[a])||[]).map(function(a){return b(c.nodesIndex[a])});return a instanceof Array?e:e[0]};this.empty=g;this.rescale=function(a,b,d,e){var g=0,f=0;d&&c.nodes.forEach(function(a){f=Math.max(a.size,f)});e&&c.edges.forEach(function(a){g=Math.max(a.size,g)});var f=f||1,g=g||1,h,i,l,q;d&&c.nodes.forEach(function(a){i=
Math.max(a.x,i||a.x);h=Math.min(a.x,h||a.x);q=Math.max(a.y,q||a.y);l=Math.min(a.y,l||a.y)});var D="outside"==c.p.scalingMode?Math.max(a/Math.max(i-h,1),b/Math.max(q-l,1)):Math.min(a/Math.max(i-h,1),b/Math.max(q-l,1)),u,j;!c.p.maxNodeSize&&!c.p.minNodeSize?(u=1,j=0):c.p.maxNodeSize==c.p.minNodeSize?(u=0,j=c.p.maxNodeSize):(u=(c.p.maxNodeSize-c.p.minNodeSize)/f,j=c.p.minNodeSize);var k,w;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(k=1,w=0):(k=c.p.maxEdgeSize==c.p.minEdgeSize?0:(c.p.maxEdgeSize-c.p.minEdgeSize)/
g,w=c.p.minEdgeSize);d&&c.nodes.forEach(function(c){c.displaySize=c.size*u+j;c.fixed||(c.displayX=(c.x-(i+h)/2)*D+a/2,c.displayY=(c.y-(q+l)/2)*D+b/2)});e&&c.edges.forEach(function(a){a.displaySize=a.size*k+w});return c};this.translate=function(a,b,d,e,g){var f=Math.pow(d,c.p.nodesPowRatio);e&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*d+a,c.displayY=c.displayY*d+b);c.displaySize*=f});f=Math.pow(d,c.p.edgesPowRatio);g&&c.edges.forEach(function(a){a.displaySize*=f});return c};this.setBorders=
function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=Math.min(void 0==c.borders.minY?a.displayY-a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,a.displayY-a.displaySize)})};
this.checkHover=function(a,b){var d,e,g,f=[],h=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{d=Math.abs(c.displayX-a);e=Math.abs(c.displayY-b);g=c.displaySize;var l=c.hover,q=d<g&&e<g&&Math.sqrt(d*d+e*e)<g;l&&!q?(c.hover=!1,h.push(c.id)):q&&!l&&(c.hover=!0,f.push(c.id))}});f.length&&c.dispatch("overnodes",f);h.length&&c.dispatch("outnodes",h);return c}}function s(b,e,g,c,a,h,d){function i(a){var b=c,d="fixed"==f.p.labelSize?f.p.defaultLabelSize:f.p.labelSizeRatio*a.displaySize;b.font=
(f.p.hoverFontStyle||f.p.fontStyle||"")+" "+d+"px "+(f.p.hoverFont||f.p.font||"");b.fillStyle="node"==f.p.labelHoverBGColor?a.color||f.p.defaultNodeColor:f.p.defaultHoverLabelBGColor;b.beginPath();f.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=f.p.labelHoverShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");
b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==f.p.nodeBorderColor?a.color||f.p.defaultNodeColor:f.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+f.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==f.p.nodeHoverColor?a.color||f.p.defaultNodeColor:f.p.defaultNodeHoverColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();
b.fill();b.fillStyle="node"==f.p.labelHoverColor?a.color||f.p.defaultNodeColor:f.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return f}function j(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-k/3&&a.displayX-a.displaySize<4*k/3&&a.displayY+a.displaySize>-p/3&&a.displayY-a.displaySize<4*p/3}sigma.classes.Cascade.call(this);var f=this;this.p=
{labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",
hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var k=h,p=d;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var b=a.nodes.length,c=0;c++<f.p.labelsSpeed&&
f.currentLabelIndex<b;)if(f.isOnScreen(a.nodes[f.currentLabelIndex])){var d=a.nodes[f.currentLabelIndex++],e=g;if(d.displaySize>=f.p.labelThreshold){var h="fixed"==f.p.labelSize?f.p.defaultLabelSize:f.p.labelSizeRatio*d.displaySize;e.font=f.p.fontStyle+h+"px "+f.p.font;e.fillStyle="node"==f.p.labelColor?d.color||f.p.defaultNodeColor:f.p.defaultLabelColor;e.fillText(d.label,Math.round(d.displayX+1.5*d.displaySize),Math.round(d.displayY+h/2-3))}}else f.currentLabelIndex++;return f.currentLabelIndex<
b};this.task_drawEdge=function(){for(var b=a.edges.length,c,d,g=0;g++<f.p.edgesSpeed&&f.currentEdgeIndex<b;)if(c=a.edges[f.currentEdgeIndex].source,d=a.edges[f.currentEdgeIndex].target,c.hidden||d.hidden||!f.isOnScreen(c)&&!f.isOnScreen(d))f.currentEdgeIndex++;else{c=a.edges[f.currentEdgeIndex++];d=c.source.displayX;var h=c.source.displayY,i=c.target.displayX,m=c.target.displayY,j=c.color;if(!j)switch(f.p.edgeColor){case "source":j=c.source.color||f.p.defaultNodeColor;break;case "target":j=c.target.color||
f.p.defaultNodeColor;break;default:j=f.p.defaultEdgeColor}var n=e;switch(c.type||f.p.defaultEdgeType){case "curve":n.strokeStyle=j;n.lineWidth=c.displaySize/3;n.beginPath();n.moveTo(d,h);n.quadraticCurveTo((d+i)/2+(m-h)/4,(h+m)/2+(d-i)/4,i,m);n.stroke();break;default:n.strokeStyle=j,n.lineWidth=c.displaySize/3,n.beginPath(),n.moveTo(d,h),n.lineTo(i,m),n.stroke()}}return f.currentEdgeIndex<b};this.task_drawNode=function(){for(var c=a.nodes.length,d=0;d++<f.p.nodesSpeed&&f.currentNodeIndex<c;)if(f.isOnScreen(a.nodes[f.currentNodeIndex])){var e=
a.nodes[f.currentNodeIndex++],g=Math.round(10*e.displaySize)/10,h=b;h.fillStyle=e.color;h.beginPath();h.arc(e.displayX,e.displayY,g,0,2*Math.PI,!0);h.closePath();h.fill();e.hover&&i(e)}else f.currentNodeIndex++;return f.currentNodeIndex<c};this.drawActiveNode=function(a){var b=c;if(!j(a))return f;var d="fixed"==f.p.labelSize?f.p.defaultLabelSize:f.p.labelSizeRatio*a.displaySize;b.font=(f.p.activeFontStyle||f.p.fontStyle||"")+" "+d+"px "+(f.p.activeFont||f.p.font||"");b.fillStyle="node"==f.p.labelHoverBGColor?
a.color||f.p.defaultNodeColor:f.p.defaultActiveLabelBGColor;b.beginPath();f.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=f.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==f.p.nodeBorderColor?
a.color||f.p.defaultNodeColor:f.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+f.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==f.p.nodeActiveColor?a.color||f.p.defaultNodeColor:f.p.defaultNodeActiveColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==f.p.labelActiveColor?a.color||f.p.defaultNodeColor:f.p.defaultLabelActiveColor;b.fillText(a.label,
Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return f};this.drawHoverNode=i;this.isOnScreen=j;this.resize=function(a,b){k=a;p=b;return f}}var y=0;h=void 0;h=[];sigma.init=function(b){b=new i(b,(++y).toString());sigma.instances[y]=new j(b);return sigma.instances[y]};sigma.tools.drawRoundRect=function(b,e,g,c,a,h,d){var h=h?h:0,i=d?d:[],i="string"==typeof i?i.split(" "):i,d=h&&(0<=i.indexOf("topleft")||0<=i.indexOf("top")||0<=i.indexOf("left")),j=h&&(0<=i.indexOf("topright")||
0<=i.indexOf("top")||0<=i.indexOf("right")),f=h&&(0<=i.indexOf("bottomleft")||0<=i.indexOf("bottom")||0<=i.indexOf("left")),i=h&&(0<=i.indexOf("bottomright")||0<=i.indexOf("bottom")||0<=i.indexOf("right"));b.moveTo(e,g+h);d?b.arcTo(e,g,e+h,g,h):b.lineTo(e,g);j?(b.lineTo(e+c-h,g),b.arcTo(e+c,g,e+c,g+h,h)):b.lineTo(e+c,g);i?(b.lineTo(e+c,g+a-h),b.arcTo(e+c,g+a,e+c-h,g+a,h)):b.lineTo(e+c,g+a);f?(b.lineTo(e+h,g+a),b.arcTo(e,g+a,e,g+a-h,h)):b.lineTo(e,g+a);b.lineTo(e,g+h)};sigma.tools.getRGB=function(b,
e){var b=b.toString(),g={r:0,g:0,b:0};if(3<=b.length&&"#"==b.charAt(0)){var c=b.length-1;6==c?g={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+b.charAt(5),16)}:3==c&&(g={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+b.charAt(3),16)})}e&&(g=[g.r,g.g,g.b]);return g};sigma.tools.rgbToHex=function(b,e,g){return sigma.tools.toHex(b)+sigma.tools.toHex(e)+sigma.tools.toHex(g)};sigma.tools.toHex=
function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.addPlugin=function(b,e,g){j.prototype[b]=e;h.push(g)};sigma.chronos=new function(){function b(a){window.setTimeout(a,0);return f}function e(){for(f.dispatch("frameinserted");k&&r.length&&g(););!k||!r.length?a():(w=(new Date).getTime(),q++,C=y-s,t=s-C,f.dispatch("insertframe"),b(e))}function g(){z%=r.length;if(!r[z].task()){var a=r[z].taskName;
v=v.filter(function(b){b.taskParent==a&&r.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});f.dispatch("killed",r.splice(z--,1)[0])}z++;y=(new Date).getTime()-w;return y<=t}function c(){k=!0;q=z=0;B=w=(new Date).getTime();f.dispatch("start");f.dispatch("insertframe");b(e);return f}function a(){f.dispatch("stop");k=!1;return f}function h(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');r.push({taskName:b,task:a});k=!(!k&&!(d&&c()||1));return f}function d(a){return a?
Object.keys(o).filter(function(a){return!!o[a].on}).length:Object.keys(o).length}function i(){Object.keys(o).length?(f.dispatch("startgenerators"),f.unbind("killed",j),b(function(){for(var a in o)o[a].on=!0,h(o[a].task,a,!1)}),f.bind("killed",j).runTasks()):f.dispatch("stopgenerators");return f}function j(a){void 0!=o[a.content.taskName]&&(o[a.content.taskName].del||!o[a.content.taskName].condition()?delete o[a.content.taskName]:o[a.content.taskName].on=!1,0==d(!0)&&i())}sigma.classes.EventDispatcher.call(this);
var f=this,k=!1,p=80,l=0,q=0,s=1E3/p,t=s,y=0,B=0,w=0,C=0,o={},r=[],v=[],z=0;this.frequency=function(a){return void 0!=a?(p=Math.abs(1*a),s=1E3/p,q=0,f):p};this.runTasks=c;this.stopTasks=a;this.insertFrame=b;this.addTask=h;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!r.concat(v).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');v.push({taskParent:c,taskName:b,task:a});return f};this.removeTask=
function(b,c){if(void 0==b)r=[],1==c?v=[]:2==c&&(r=v,v=[]),a();else{var d="string"==typeof b?b:"";r=r.filter(function(a){return("string"==typeof b?a.taskName==b:a.task==b)?(d=a.taskName,!1):!0});0<c&&(v=v.filter(function(a){1==c&&a.taskParent==d&&r.push(a);return a.taskParent!=d}))}k=!(r.length&&(!a()||1));return f};this.addGenerator=function(a,b,c){if(void 0!=o[a])return f;o[a]={task:b,condition:c};0==d(!0)&&i();return f};this.removeGenerator=function(a){o[a]&&(o[a].on=!1,o[a].del=!0);return f};
this.startGenerators=i;this.getGeneratorsIDs=function(){return Object.keys(o)};this.getFPS=function(){k&&(l=Math.round(1E4*(q/((new Date).getTime()-B)))/10);return l};this.getTasksCount=function(){return r.length};this.getQueuedTasksCount=function(){return v.length};this.getExecutionTime=function(){return w-B};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var b in arguments)console.log(arguments[b]);else if(1<sigma.debugMode)for(b in arguments)throw Error(arguments[b]);
return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.publicPrototype=j.prototype})();
